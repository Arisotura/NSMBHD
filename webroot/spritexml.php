<?php$ajaxPage = true;require('lib/common.php');ob_start();$cats = Query("SELECT * FROM {spritecategories} ORDER BY ord, id");$objects = Query("	SELECT		s.*	FROM		{spriterevisions} sr		LEFT JOIN {sprites} s ON s.id=sr.id AND s.revision=sr.revision	ORDER BY id");echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n";echo "\r\n";echo "<!-- NSMB Sprite Database, generated ".date('m/d/Y H:i:s')." for NSMB Editor. http://nsmbhd.net/ -->\r\n";echo "\r\n";echo "<database timestamp=\"".time()."\">\r\n";echo "\r\n";echo "\t<categories>\r\n";while ($cat = Fetch($cats)){	echo "\t\t<category id=\"{$cat['id']}\">".htmlspecialchars($cat['name'])."</category>\r\n";}echo "\t</categories>\r\n";echo "\r\n";echo "\t<sprites>\r\n";while ($obj = Fetch($objects)){	echo "\t\t<sprite id=\"".htmlspecialchars($obj['id'])."\">\r\n";		echo "\t\t\t<name>".htmlspecialchars($obj['name'])."</name>\r\n";	echo "\t\t\t<flags known=\"{$obj['known']}\" complete=\"{$obj['complete']}\" />\r\n";	echo "\t\t\t<category id=\"{$obj['category']}\" />\r\n";	echo "\t\t\t<notes>".htmlspecialchars($obj['notes'])."</notes>\r\n";	echo "\t\t\t<files>".htmlspecialchars($obj['files'])."</files>\r\n";		$fields = @unserialize($obj['fields']);	if ($fields)	{		foreach ($fields as $field)		{			echo "\t\t\t<field id=\"{$field[1]}\" type=\"{$field[0]}\" name=\"".htmlspecialchars($field[3])."\" values=\"".htmlspecialchars($field[2])."\" notes=\"".htmlspecialchars($field[4])."\" />\r\n";		}	}		echo "\t\t</sprite>\r\n";	echo "\r\n";}echo "\t</sprites>\r\n";echo "</database>\r\n";$db = ob_get_clean();header('Content-type: text/xml; charset=utf-8');//header('Content-disposition: attachment; filename="objectdb.xml"');header('Content-length: '.strlen($db));echo $db;?>